apply plugin: 'java'
apply plugin: 'application'

sourceCompatibility = JavaVersion.VERSION_11
version = '1.0'
application {
    mainClass = 'org.dstadler.exit.ButtonDigitSpinning'
}

jar {
    manifest {
        attributes 'Implementation-Title': 'Exit The Room main application', 'Implementation-Version': archiveVersion
    }
}

repositories {
    mavenCentral()
}

configurations {
    // some transitive dependencies which should not be needed
    all*.exclude group: 'org.apache.httpcomponents'
    all*.exclude group: 'log4j'
    all*.exclude group: 'net.java.dev.jna'
}

dependencies {
    implementation 'com.pi4j:pi4j-core:1.2'
    //implementation 'com.pi4j:pi4j-device:1.2'

    implementation 'org.dstadler:commons-dost:1.3.2'
    implementation 'commons-io:commons-io:2.16.1'
    implementation 'org.apache.commons:commons-lang3:3.14.0'
	implementation 'org.apache.commons:commons-exec:1.4.0'

    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.10.2'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.10.2'
    testImplementation 'org.mockito:mockito-core:5.11.0'
}

wrapper {
    gradleVersion = '8.5'
}

task adjustWrapperPropertiesFile {
	doLast() {
		ant.replaceregexp(match: '^#.*', replace: '', flags: 'g', byline: true) {
			fileset(dir: project.projectDir, includes: 'gradle/wrapper/gradle-wrapper.properties')
		}
		new File(project.projectDir, 'gradle/wrapper/gradle-wrapper.properties').with {
			it.text = it.readLines().findAll { it }.sort().join('\n')
		}
		ant.fixcrlf(file: 'gradle/wrapper/gradle-wrapper.properties', eol: 'lf')
	}
}
wrapper.finalizedBy adjustWrapperPropertiesFile

task example(type: JavaExec) {
    classpath = sourceSets.main.runtimeClasspath

    maxHeapSize = '64m'
    mainClass = 'org.dstadler.exit.Example'
}

task buttonSpinning(type: JavaExec) {
    classpath = sourceSets.main.runtimeClasspath

    maxHeapSize = '64m'
    mainClass = 'org.dstadler.exit.ButtonSpinning'
}

task buttonDigitSpinning(type: JavaExec) {
    classpath = sourceSets.main.runtimeClasspath

    maxHeapSize = '64m'
    mainClass = 'org.dstadler.exit.ButtonDigitSpinning'
}

task sysInfo(type: JavaExec) {
    classpath = sourceSets.main.runtimeClasspath

    maxHeapSize = '64m'
    mainClass = 'org.dstadler.exit.SystemInformation'
}

task ledBlink(type: JavaExec) {
    classpath = sourceSets.main.runtimeClasspath

    maxHeapSize = '64m'
    mainClass = 'org.dstadler.exit.LEDBlink'
}

task dots(type: JavaExec) {
    classpath = sourceSets.main.runtimeClasspath

    maxHeapSize = '64m'
    mainClass = 'org.dstadler.exit.Dots'
}

task musicPlayer(type: JavaExec) {
    classpath = sourceSets.main.runtimeClasspath

    maxHeapSize = '64m'
    mainClass = 'org.dstadler.exit.MusicPlayer'
    args = [
             'audio/Royal Entrance Fanfare - Randy Dunn, heralding trumpet-NkD0MxNY_Bw_trimmed.mp3',
             'audio/background.mp3',
             'audio/test2.mp3',
             'audio/Female-shout.wav-218417.mp3',
             'audio/test1.mp3'
    ]
}
